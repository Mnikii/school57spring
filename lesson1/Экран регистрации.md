# **ТЗ: Экран регистрации**

---

## **Раздел 1: Точки входа**

Экран регистрации доступен по следующим точкам входа:

- **С экрана авторизации при нажатии на кнопку "Зарегистрироваться"**: Пользователь перенаправляется на `/register`.
- **По прямой ссылке `/register` (веб-приложение)**: Пользователь может перейти напрямую по этому URL.

---

## **Раздел 2: Суть экрана**

Экран предназначен для того, чтобы новый пользователь создал учетную запись в системе. Пользователь вводит логин, email и пароль, после чего нажимает кнопку **"Зарегистрироваться"**.

**URL страницы:** `/register`

---

## **Раздел 3: Дизайн. Состояния экрана**

| Состояние         | Описание                                                                                                  |
|-------------------|-----------------------------------------------------------------------------------------------------------|
| **По умолчанию**  | Поля ввода пустые. Кнопка неактивна, пока не заполнены все обязательные поля корректно.                   |
| **Ввода**         | Поля подсвечиваются при фокусе. При ошибках — сообщения валидации под полями.                             |
| **Загрузки**      | Кнопка показывает спиннер. Поля блокируются для предотвращения повторной отправки.                        |
| **Ошибки**        | Под формой или полем — сообщение об ошибке (например, <span style="color: #e74c3c">"Email уже занят"</span>). |
| **Успеха**        | Показывается <span style="color: #27ae60">toast-уведомление</span>, редирект на `/calendar` или `/`.       |

---

## **Раздел 4: Запросы при входе на экран**

| Метод | Эндпоинт               | Swagger | Описание                                                                 |
|-------|------------------------|---------|--------------------------------------------------------------------------|
| GET   | `/register`            | ❌ Нет  | Клиентский маршрут. API не вызывается — просто рендерится форма.         |
| POST  | `/api/auth/register`   | ✅ Да   | Вызывается при отправке формы. Создает нового пользователя на сервере.   |

> **Swagger:** Описан в `./src/auth/auth.controller.ts`

---

## **Раздел 5: Взаимодействие с пользователем (Функциональные требования)**

Форма содержит **три обязательных поля**: **логин**, **email**, **пароль**.

### Порядок действий:

1. **Клиентская валидация при отправке:**
   - **Логин**: 3–50 символов.
   - **Email**: валидный формат.
   - **Пароль**: 6–200 символов.
   > ⚠️ *На бэкенде нет требования "буква + цифра", но фронтенд может добавить для UX.*

2. Если валидация пройдена — отправляется `POST /api/auth/register`.

3. **Успех:**
   - Показ toast-уведомления.
   - Редирект на главную (`/calendar` или `/`).

4. **Ошибка:**
   - Показ сообщения об ошибке (например, <span style="color: #e74c3c">"Пользователь уже существует"</span>).

5. **Пустая форма:**
   - Под каждым пустым полем — сообщение об ошибке.

6. **Ошибка валидации:**
   - Под полем — текст ошибки.

---

## **Раздел 6: Нефункциональные требования**

| Категория      | Требование                                                                 |
|----------------|----------------------------------------------------------------------------|
| **Производительность** | Загрузка экрана ≤ 1 сек, обработка регистрации ≤ 3 сек.                    |
| **Совместимость**      | Chrome, Firefox, Safari.                                                   |
| **Безопасность**       | Пароль хешируется через `bcrypt`. Уникальность логина/email. HTTPS обязателен. |

---

## **Раздел 7: Блоки экрана**

### **Таблица: Блоки интерфейса**

| Название блока                     | Источник данных           | Элементы / Условия отображения                                                                 | Примечания                                                                 |
|------------------------------------|---------------------------|------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|
| **Поля ввода для Регистрации**     | `GET /register` (клиент)  | Поле "Логин" — всегда<br>Поле "Email" — всегда<br>Поле "Пароль" — всегда<br>Кнопка — всегда    | Валидация: логин (3-50), email (формат), пароль (≥6). Кнопка активна только при валидных данных. |
| **Алерт "Успешная регистрация"**   | После `POST /api/auth/register` (201) | Всегда после успеха                                                                             | Toast + редирект.                                                          |
| **Алерт "Ошибка регистрации"**     | После `POST /api/auth/register` (4xx/5xx) | При ошибке сервера                                                                              | Показывает текст ошибки от сервера.                                        |
| **Сообщения валидации под полями** | При потере фокуса или отправке формы | При невалидном вводе                                                                            | Логин: "3-50 символов"<br>Email: "Корректный email"<br>Пароль: "≥6 символов" |

---

## **Раздел 8: Ошибки и поведение блоков при ошибках на запросы**

### **Таблица: Ошибки и действия интерфейса**

| Код ошибки   | Причина ошибки                     | Действие интерфейса                                                                 |
|--------------|------------------------------------|-------------------------------------------------------------------------------------|
| **Клиент**   | Ошибка валидации на фронтенде      | Сообщения под полями, кнопка неактивна до исправления                               |
| **400**      | Пользователь уже существует        | <span style="color: #e74c3c">Сообщение от сервера</span>, подсветка поля (логин/email) |
| **500**      | Внутренняя ошибка сервера          | <span style="color: #e74c3c">"Произошла внутренняя ошибка сервера. Попробуйте позже"</span> |
| **Сеть**     | Нет соединения / таймаут           | <span style="color: #e74c3c">"Нет соединения с сервером. Проверьте интернет"</span> |

---

## **Раздел 9: Описание задачи на бэкенд разработку**

### **Endpoint регистрации**

- **Метод:** `POST`
- **Эндпоинт:** `/api/auth/register`
- **Параметры:**
  - `username` (string, 3-50) — **обязательно**
  - `email` (string) — **обязательно**
  - `password` (string, 6-200) — **обязательно**
  - `defaultCurrencyId` (number, optional)

### **Логика работы:**

1. Проверка уникальности `username` и `email`.
2. Валидация данных.
3. Хэширование пароля через `bcrypt`.
4. Сохранение в БД.
5. Генерация JWT токена.
6. Возврат токена или ошибки 400.

### **Примеры ответов:**

✅ **Успех (201):**
```
{
  "success": true,
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.x.x"
  }
}
```
   **Ошибка (400):**
 ```
{
  "statusCode": 400,
  "message": "User with username \"john_doe\" already exists",
  "error": "Bad Request"
}
```
## **Раздел 10: Sequence diagramm**

![Screenshot_8.jpg](https://gitlab.education.tbank.ru/tclass-frontend-angular-2025/Lectures/-/raw/master/lesson-3-Spec/Screenshot_8.jpg?ref_type=heads)

## **Раздел 11: Аналитика**

| Событие                    | Параметры                           | Описание                                          |
|----------------------------|-------------------------------------|---------------------------------------------------|
| **registration_attempt**   | login, timestamp                    | попытка регистрации                               |
| **registration_success**   | login, timestamp                    | успешная регистрация                              |
| **registration_error**     | login, error_message, timestamp     | ошибка в регистрации                              |
